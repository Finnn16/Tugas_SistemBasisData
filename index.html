<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplikasi CRUD Buku</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out;
    }

    .animate-slideIn {
      animation: slideIn 0.3s ease-out;
    }

    .animate-pulse-custom {
      animation: pulse 1.5s infinite;
    }

    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .card-hover {
      transition: all 0.3s ease;
    }

    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      transition: all 0.3s ease;
    }

    .btn-secondary:hover {
      transform: translateY(-1px);
    }

    .input-focus {
      transition: all 0.3s ease;
    }

    .input-focus:focus {
      transform: scale(1.02);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .notification {
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }
  </style>
</head>

<body class="gradient-bg min-h-screen p-6">
  <!-- Notification -->
  <div id="notification"
    class="notification fixed top-4 right-4 z-50 p-4 rounded-lg text-white font-medium shadow-lg hidden">
    <div class="flex items-center">
      <div id="notificationIcon" class="mr-2"></div>
      <span id="notificationText"></span>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 hidden">
    <div class="glass-effect p-8 rounded-xl text-center">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
      <p class="text-gray-700 font-medium">Memproses data...</p>
    </div>
  </div>

  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8 animate-fadeIn">
      <h1 class="text-5xl font-bold text-white mb-2 drop-shadow-lg">ðŸ“š Manajemen Buku</h1>
      <p class="text-white/80 text-lg font-medium">Kelola koleksi buku Anda dengan mudah</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-8">
      <!-- Form Input -->
      <div class="glass-effect p-8 rounded-2xl shadow-2xl card-hover animate-fadeIn">
        <div class="flex items-center mb-6">
          <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-full mr-4">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6">
              </path>
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-gray-800">Tambah / Edit Buku</h2>
        </div>

        <form id="bookForm" class="space-y-6">
          <input type="hidden" id="bookId">

          <div class="space-y-2">
            <label for="title" class="block text-sm font-semibold text-gray-700 flex items-center">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253">
                </path>
              </svg>
              Judul Buku
            </label>
            <input type="text" id="title"
              class="input-focus w-full p-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none bg-white/80"
              placeholder="Masukkan judul buku..." required>
          </div>

          <div class="space-y-2">
            <label for="author" class="block text-sm font-semibold text-gray-700 flex items-center">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              Nama Penulis
            </label>
            <input type="text" id="author"
              class="input-focus w-full p-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none bg-white/80"
              placeholder="Masukkan nama penulis..." required>
          </div>

          <div class="space-y-2">
            <label for="year" class="block text-sm font-semibold text-gray-700 flex items-center">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              Tahun Terbit
            </label>
            <input type="number" id="year"
              class="input-focus w-full p-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none bg-white/80"
              placeholder="2024" required>
          </div>

          <div class="flex space-x-4">
            <button type="submit" id="submitBtn"
              class="btn-primary flex-1 text-white px-6 py-4 rounded-xl font-semibold shadow-lg flex items-center justify-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6">
                </path>
              </svg>
              Tambah Buku
            </button>
            <button type="button" id="cancelBtn"
              class="btn-secondary bg-gray-300 text-gray-700 px-6 py-4 rounded-xl font-semibold hover:bg-gray-400 hidden flex items-center justify-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
              Batal
            </button>
          </div>
        </form>
      </div>

      <!-- Statistics Card -->
      <div class="glass-effect p-8 rounded-2xl shadow-2xl card-hover animate-fadeIn">
        <div class="flex items-center mb-6">
          <div class="bg-gradient-to-r from-green-500 to-blue-600 p-3 rounded-full mr-4">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
              </path>
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-gray-800">Statistik Koleksi</h2>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-6 rounded-xl text-white text-center">
            <div class="text-3xl font-bold" id="totalBooks">0</div>
            <div class="text-sm opacity-90">Total Buku</div>
          </div>
          <div class="bg-gradient-to-r from-green-500 to-teal-600 p-6 rounded-xl text-white text-center">
            <div class="text-3xl font-bold" id="uniqueAuthors">0</div>
            <div class="text-sm opacity-90">Penulis Unik</div>
          </div>
        </div>

        <div class="mt-6 p-4 bg-white/50 rounded-xl">
          <h3 class="font-semibold text-gray-700 mb-2">Buku Terbaru</h3>
          <div id="latestBook" class="text-gray-600 italic">Belum ada buku</div>
        </div>
      </div>
    </div>

    <!-- Tabel Data -->
    <div class="glass-effect p-8 rounded-2xl shadow-2xl mt-8 card-hover animate-fadeIn">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
          <div class="bg-gradient-to-r from-purple-500 to-pink-600 p-3 rounded-full mr-4">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 00-2 2v2m0 0V9a2 2 0 012-2h14a2 2 0 012 2v2M7 7V3a2 2 0 012-2h6a2 2 0 012 2v4M9 7h6">
              </path>
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-gray-800">Daftar Buku</h2>
        </div>

        <div class="flex items-center space-x-4">
          <div class="relative">
            <input type="text" id="searchInput" placeholder="Cari buku..."
              class="pl-10 pr-4 py-2 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none bg-white/80">
            <svg class="w-4 h-4 absolute left-3 top-3 text-gray-400" fill="none" stroke="currentColor"
              viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
      </div>

      <div class="overflow-hidden rounded-xl border border-gray-200">
        <table class="w-full">
          <thead class="bg-gradient-to-r from-gray-800 to-gray-600 text-white">
            <tr>
              <th class="px-6 py-4 text-left font-semibold">Judul</th>
              <th class="px-6 py-4 text-left font-semibold">Penulis</th>
              <th class="px-6 py-4 text-left font-semibold">Tahun</th>
              <th class="px-6 py-4 text-center font-semibold">Aksi</th>
            </tr>
          </thead>
          <tbody id="bookTable" class="bg-white divide-y divide-gray-100">
            <!-- Data akan dimuat di sini -->
          </tbody>
        </table>
      </div>

      <div id="emptyState" class="text-center py-12 hidden">
        <div class="text-gray-400 mb-4">
          <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253">
            </path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-gray-600 mb-2">Belum ada buku</h3>
        <p class="text-gray-500">Tambahkan buku pertama Anda untuk memulai koleksi!</p>
      </div>
    </div>
  </div>

  <script>
    // Inisialisasi Supabase
    const supabaseUrl = 'https://xlacgwtojpfrviqxsjly.supabase.co';
    const supabaseKey = 'sb_publishable_I1VDmCwXsZrOgYv60TTYXA_lSLeFtPb';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // Form dan elemen
    const bookForm = document.getElementById('bookForm');
    const bookTable = document.getElementById('bookTable');
    const submitBtn = document.getElementById('submitBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const bookIdInput = document.getElementById('bookId');
    const searchInput = document.getElementById('searchInput');
    const emptyState = document.getElementById('emptyState');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');
    const notificationIcon = document.getElementById('notificationIcon');

    let allBooks = [];

    // Fungsi notifikasi
    function showNotification(message, type = 'success') {
      const icons = {
        success: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',
        error: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',
        info: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'
      };

      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        info: 'bg-blue-500'
      };

      notification.className = `notification ${colors[type]} fixed top-4 right-4 z-50 p-4 rounded-lg text-white font-medium shadow-lg show`;
      notificationIcon.innerHTML = icons[type];
      notificationText.textContent = message;

      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.classList.add('hidden'), 300);
      }, 3000);
    }

    // Fungsi loading
    function showLoading() {
      loadingOverlay.classList.remove('hidden');
    }

    function hideLoading() {
      loadingOverlay.classList.add('hidden');
    }

    // Fungsi untuk mengupdate statistik
    function updateStatistics() {
      const totalBooks = allBooks.length;
      const uniqueAuthors = [...new Set(allBooks.map(book => book.author))].length;
      const latestBook = allBooks.length > 0 ? allBooks.sort((a, b) => b.year - a.year)[0] : null;

      document.getElementById('totalBooks').textContent = totalBooks;
      document.getElementById('uniqueAuthors').textContent = uniqueAuthors;
      document.getElementById('latestBook').textContent = latestBook ?
        `${latestBook.title} (${latestBook.year})` : 'Belum ada buku';
    }

    // Fungsi untuk mengambil dan menampilkan data
    async function loadBooks() {
      showLoading();

      const { data, error } = await supabase
        .from('books')
        .select('*')
        .order('title', { ascending: true });

      hideLoading();

      if (error) {
        console.error('Error fetching books:', error);
        showNotification('Gagal memuat data buku', 'error');
        return;
      }

      allBooks = data;
      displayBooks(data);
      updateStatistics();
    }

    // Fungsi untuk menampilkan buku
    function displayBooks(books) {
      bookTable.innerHTML = '';

      if (books.length === 0) {
        emptyState.classList.remove('hidden');
        return;
      }

      emptyState.classList.add('hidden');

      books.forEach((book, index) => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-blue-50 transition-colors duration-200 animate-slideIn';
        row.style.animationDelay = `${index * 0.1}s`;

        row.innerHTML = `
          <td class="px-6 py-4 font-medium text-gray-900">${book.title}</td>
          <td class="px-6 py-4 text-gray-600">${book.author}</td>
          <td class="px-6 py-4 text-gray-600">${book.year}</td>
          <td class="px-6 py-4 text-center">
            <div class="flex justify-center space-x-2">
              <button onclick="editBook('${book.id}', '${book.title.replace(/'/g, "\\'")}', '${book.author.replace(/'/g, "\\'")}', ${book.year})" 
                class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-4 py-2 rounded-lg hover:from-yellow-500 hover:to-orange-600 transition-all duration-200 transform hover:scale-105 shadow-md flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                Edit
              </button>
              <button onclick="deleteBook('${book.id}', '${book.title.replace(/'/g, "\\'")}' )" 
                class="bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 transform hover:scale-105 shadow-md flex items-center">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Hapus
              </button>
            </div>
          </td>
        `;
        bookTable.appendChild(row);
      });
    }

    // Fungsi pencarian
    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      const filteredBooks = allBooks.filter(book =>
        book.title.toLowerCase().includes(searchTerm) ||
        book.author.toLowerCase().includes(searchTerm) ||
        book.year.toString().includes(searchTerm)
      );
      displayBooks(filteredBooks);
    });

    // Fungsi untuk menambah atau mengupdate buku
    bookForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      showLoading();

      const title = document.getElementById('title').value;
      const author = document.getElementById('author').value;
      const year = parseInt(document.getElementById('year').value);
      const bookId = bookIdInput.value;

      if (bookId) {
        // Update buku
        const { error } = await supabase
          .from('books')
          .update({ title, author, year })
          .eq('id', bookId);

        if (error) {
          console.error('Error updating book:', error);
          showNotification('Gagal mengupdate buku', 'error');
          hideLoading();
          return;
        }
        showNotification('Buku berhasil diupdate!', 'success');
      } else {
        // Tambah buku baru
        const { error } = await supabase
          .from('books')
          .insert([{ title, author, year }]);

        if (error) {
          console.error('Error adding book:', error);
          showNotification('Gagal menambah buku', 'error');
          hideLoading();
          return;
        }
        showNotification('Buku berhasil ditambahkan!', 'success');
      }

      resetForm();
      await loadBooks();
      hideLoading();
    });

    // Fungsi untuk mengedit buku
    function editBook(id, title, author, year) {
      bookIdInput.value = id;
      document.getElementById('title').value = title;
      document.getElementById('author').value = author;
      document.getElementById('year').value = year;

      submitBtn.innerHTML = `
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
        </svg>
        Update Buku
      `;

      cancelBtn.classList.remove('hidden');

      // Scroll ke form
      document.querySelector('.glass-effect').scrollIntoView({ behavior: 'smooth' });
      showNotification('Mode edit aktif', 'info');
    }

    // Fungsi untuk menghapus buku
    async function deleteBook(id, title) {
      if (confirm(`Yakin ingin menghapus buku "${title}"?`)) {
        showLoading();

        const { error } = await supabase
          .from('books')
          .delete()
          .eq('id', id);

        if (error) {
          console.error('Error deleting book:', error);
          showNotification('Gagal menghapus buku', 'error');
          hideLoading();
          return;
        }

        showNotification('Buku berhasil dihapus!', 'success');
        await loadBooks();
        hideLoading();
      }
    }

    // Fungsi untuk mereset form
    function resetForm() {
      bookForm.reset();
      bookIdInput.value = '';
      submitBtn.innerHTML = `
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
        Tambah Buku
      `;
      cancelBtn.classList.add('hidden');
    }

    // Event listener untuk tombol batal
    cancelBtn.addEventListener('click', () => {
      resetForm();
      showNotification('Edit dibatalkan', 'info');
    });

    // Muat data saat halaman dibuka
    document.addEventListener('DOMContentLoaded', () => {
      loadBooks();
      showNotification('Aplikasi siap digunakan!', 'success');
    });
  </script>
</body>

</html>